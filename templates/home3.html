<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <meta charset="UTF-8"> -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/style.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/modal.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/font.css') }}">
    <!-- <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/graph.css') }}"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- <link href='https://fonts.googleapis.com/css?family=Open+Sans|Open+Sans+Condensed:300,700' rel='stylesheet' type='text/css'> -->
    <!-- <script type="text/javascript" src="{{ url_for('static', filename='js/fact.js') }}"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script> -->

    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!-- <script src="//d3js.org/d3-scale-chromatic.v1.min.js"></script> -->

    <!-- conversation -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Fact Checking</title>
    <link rel='stylesheet' id='style-css' href="{{ url_for('static', filename='styles/style_conservation.css') }}"
        type='text/css' media='all' />
    <script>
        'use strict';

        window.chartColors = {
            red: 'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64)',
            yellow: 'rgb(255, 205, 86)',
            green: 'rgb(75, 192, 192)',
            blue: 'rgb(54, 162, 235)',
            purple: 'rgb(153, 102, 255)',
            grey: 'rgb(201, 203, 207)'
        };

        (function (global) {
            var MONTHS = [
                '100',
                '200',
                '300',
                '400',
                '500',
                '600',
                '700',
            ];

            var COLORS = [
                '#4dc9f6',
                '#f67019',
                '#f53794',
                '#537bc4',
                '#acc236',
                '#166a8f',
                '#00a950',
                '#58595b',
                '#8549ba'
            ];

            var Samples = global.Samples || (global.Samples = {});
            var Color = global.Color;

            Samples.utils = {
                // Adapted from http://indiegamr.com/generate-repeatable-random-numbers-in-js/
                srand: function (seed) {
                    this._seed = seed;
                },

                rand: function (min, max) {
                    var seed = this._seed;
                    min = min === undefined ? 0 : min;
                    max = max === undefined ? 1 : max;
                    this._seed = (seed * 9301 + 49297) % 233280;
                    return min + (this._seed / 233280) * (max - min);
                },

                numbers: function (config) {
                    var cfg = config || {};
                    var min = cfg.min || 0;
                    var max = cfg.max || 1;
                    var from = cfg.from || [];
                    var count = cfg.count || 8;
                    var decimals = cfg.decimals || 8;
                    var continuity = cfg.continuity || 1;
                    var dfactor = Math.pow(10, decimals) || 0;
                    var data = [];
                    var i, value;

                    for (i = 0; i < count; ++i) {
                        value = (from[i] || 0) + this.rand(min, max);
                        if (this.rand() <= continuity) {
                            data.push(Math.round(dfactor * value) / dfactor);
                        } else {
                            data.push(null);
                        }
                    }

                    return data;
                },

                labels: function (config) {
                    var cfg = config || {};
                    var min = cfg.min || 0;
                    var max = cfg.max || 100;
                    var count = cfg.count || 8;
                    var step = (max - min) / count;
                    var decimals = cfg.decimals || 8;
                    var dfactor = Math.pow(10, decimals) || 0;
                    var prefix = cfg.prefix || '';
                    var values = [];
                    var i;

                    for (i = min; i < max; i += step) {
                        values.push(prefix + Math.round(dfactor * i) / dfactor);
                    }

                    return values;
                },

                months: function (config) {
                    var cfg = config || {};
                    var count = cfg.count || 12;
                    var section = cfg.section;
                    var values = [];
                    var i, value;

                    for (i = 0; i < count; ++i) {
                        value = MONTHS[Math.ceil(i) % 12];
                        values.push(value.substring(0, section));
                    }

                    return values;
                },

                color: function (index) {
                    return COLORS[index % COLORS.length];
                },

                transparentize: function (color, opacity) {
                    var alpha = opacity === undefined ? 0.5 : 1 - opacity;
                    return Color(color).alpha(alpha).rgbString();
                }
            };

            // DEPRECATED
            window.randomScalingFactor = function () {
                return Math.round(Samples.utils.rand(-100, 100));
            };

            // INITIALIZATION

            Samples.utils.srand(Date.now());

            // Google Analytics
            /* eslint-disable */
            if (document.location.hostname.match(/^(www\.)?chartjs\.org$/)) {
                (function (i, s, o, g, r, a, m) {
                    i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                        (i[r].q = i[r].q || []).push(arguments)
                    }, i[r].l = 1 * new Date(); a = s.createElement(o),
                        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
                })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
                ga('create', 'UA-28909194-3', 'auto');
                ga('send', 'pageview');
            }
            /* eslint-enable */

        }(this));

    </script>
</head>

<body>
    <div id="budget-modal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Optimize Budget Allocation</h2>
            </div>
            <div class="modal-body">
                <form method=post action="/" enctype=multipart/form-data> <h4>Budget</h4>
                    <input type=number value=0 name=budget style="font-size: 18px;">
                    <input type="submit" value="OK" class="button">
                </form>
            </div>
        </div>
    </div>
    <div class="grid-container">
        <div class="header">
            <div class="grid-header">
                <div id="logo-griffith">
                    <a href="/">
                        <div>Fact Checking</div>
                    </a>
                </div>
                <div id="select-file" class="header-content">
                    <form method=post action="/upload" enctype=multipart/form-data> <input type="file" name="file"
                        id="file" class="inputfile" data-multiple-caption="{count} files selected" multiple />
                    <input type=submit value=Upload id="upload-btn">
                    </form>
                </div>
                <div class="header-content" style="text-align: right;">
                    <button class="button">
                        <a href="/download" style="color: white">Take Snapshot</a>
                    </button>
                    <!-- <a class="button" href="/download">Take Snapshot</a> -->
                    <button class="button" id="myBtn">Optimize Budget Allocation</button>
                    <button class="button">Stop Feedback</button>
                </div>
            </div>
        </div>
        <div id="block-content">
            <!-- <div style="display:none">
                <div id="title-list-claim">
                    <span>Claims</span>
                    <select name="mode" onchange="selectMode(this)">
                        <option value="block-list-claim" selected>Claims</option>
                        <option value="block-list-source">Sources</option>
                    </select>
                    <input type="text" id="input-for-claim" onkeyup="searchClaim()" placeholder="Search for claims.."
                        title="Type in a name">
                </div>
                <div id="block-list-claim" class="listcontent item-select">
                    <ul id="list-claim">
                        {% for claim in data %}
                        <li onclick="selectClaim({{ loop.index }},{{ claim }});drawRelation({{ claim }})"
                            id="{{ claim.id }}">
                            <div>
                                <span class="no-claim">{{ loop.index }}. </span> {{ claim.claim }}
                            </div>
                            <div class="container">
                                <div class="progress2 progress-moved">
                                    <div class="progress-bar2">
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                <div id="block-list-source" class="listcontent item-select">
                    <ul>
                        {%for source in sources%}
                        <li>
                            <div class="title-source">
                                <span class="no-claim">{{ loop.index }}. </span>
                                {{ source[0] }}
                            </div>
                            <div class="complete-source">
                                <div style="float: left;padding: 0;margin: 0;">Complete</div>
                                <div style="float: right;padding: 0;margin: 0; " >3/10</span>
                            </div>
                            <div class="content-source-item">
                                <ul>
                                    {% for claim in source[1] %}
                                    <li onclick="selectClaim({{ loop.index }},{{ claim }});drawRelation({{ claim }})"
                                        id="{{ claim.id }}">
                                        <div style="font-size: 12px;">
                                            <span class="no-claim" style="font-size: 12px;">{{ loop.index }}. </span>
                                            {{ claim.claim }}
                                        </div>
                                        <div class="container">
                                            <div class="progress2 progress-moved">
                                                <div class="progress-bar2" style="height: 2px;">
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </ul>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div> -->
            <div id="overview">
                <div id="analysis">
                    <div class="item-analysis">
                        <div style="text-align: right;" class="icon-item-analysis">
                            <i class="fa fa-calendar" aria-hidden="true"></i>
                        </div>
                        <div style="text-align: left;" class="detail-item-analysis">
                            <div class="title-detail-item-analysis">
                                Total Claims
                            </div>
                            <div class="value-detail-item-analysis">
                                4,746
                            </div>
                        </div>
                    </div>
                    <div class="item-analysis">
                        <div style="text-align: right;" class="icon-item-analysis">
                            <i class="fa fa-tripadvisor" aria-hidden="true"></i>
                        </div>
                        <div style="text-align: left;" class="detail-item-analysis">
                            <div class="title-detail-item-analysis">
                                Remains
                            </div>
                            <div class="value-detail-item-analysis">
                                1,023
                            </div>
                        </div>
                    </div>
                    <div class="item-analysis">
                        <div style="text-align: right;" class="icon-item-analysis">
                            <i class="fa fa-stack-overflow" aria-hidden="true"></i>
                        </div>
                        <div style="text-align: left;" class="detail-item-analysis">
                            <div class="title-detail-item-analysis">
                                Creidibility
                            </div>
                            <div class="value-detail-item-analysis" style="color:green;">
                                300(75%)
                            </div>
                        </div>
                    </div>
                    <div class="item-analysis">
                        <div style="text-align: right;" class="icon-item-analysis">
                            <i class="fa fa-diamond" aria-hidden="true"></i>
                        </div>
                        <div style="text-align: left;" class="detail-item-analysis" style="background-color: red;">
                            <div class="title-detail-item-analysis">
                                Non-Creidibility
                            </div>
                            <div class="value-detail-item-analysis" style="color: red;">
                                50(20%)
                            </div>
                        </div>
                    </div>
                </div>
                <div style="padding: 20px 40px; text-align: center;" id="chart-overview">
                    <!-- <img src="./img/chart.PNG" width="60%" height="100px"> -->
                    <!-- <input type="range" name="mySlider" id=mySlider min="10" max="100" value="50"> -->
                    <!-- <div id="my_dataviz"></div> -->
                    <div style="width:600px;">
                        <div class="chartjs-size-monitor">
                            <div class="chartjs-size-monitor-expand">
                                <div class=""></div>
                            </div>
                            <div class="chartjs-size-monitor-shrink">
                                <div class=""></div>
                            </div>
                        </div>
                        <canvas id="canvas" style="display: block; width: 600px; height: 300px;" width="600"
                            height="300" class="chartjs-render-monitor"></canvas>
                    </div>

                </div>
                <div>
                    <button id="toggle-overview">
                        <i id="icon-toggle-overview" class="fa fa-chevron-up" style="font-size: 30px; color: #999;"
                            aria-hidden="true"></i>
                    </button>
                </div>
            </div>

            <div id="fact-checking">
                <div style="height: 700px;">
                    <div class="tab" id="header-checking">
                        <button class="tablinks" onclick="openCity(event,'overview-sources')" id="defaultOpen">
                            <i class="fa fa-instagram" aria-hidden="true"></i>
                            Sources
                        </button>
                        <button class="tablinks" onclick="openCity(event, 'claims')">
                            <i class="fa fa-wpforms" aria-hidden="true"></i>
                            Claims
                        </button>
                        <!-- <button style="float: right;" id="toggle-overview">Toggle Overview</button> -->
                        <!-- <div>
                                <form method=post action="/process">
                                    <input type="hidden" name="claimId" value="{{ data[0].claim_id }}">
                                    <input type=submit style="margin-right: 30px;" class="btn-validation" name="Credibility"
                                        value="Non-Credibility">
                                    <input type=submit class="btn-validation" name="Credibility" value="Credibility">
                                </form>
                            </div> -->
                    </div>
                    <div style="height: 580px;" id="overview-sources" class="tabcontent item-tab">
                        <div style="display: grid; grid-template-columns: 70% 30%;">
                            <div id="heatmap-sources">
                                <input type="text" id="input-sourceFilter" onkeyup="filterSource()" placeholder="Search for names.."
                                    title="Type in a name">

                                <table id="heatmap-sources">
                                </table>
                            </div>

                            <div id="detail-source">
                                <!-- <div id="title-source-item">Source</div> -->
                                <!-- <div>
                                    <span>Total : </span>
                                    <span id="total-claim-source-item">2000</span>
                                </div> -->

                                <!-- <div>
                                    <span>Validation : </span>
                                    <span id="validation-source-item">1000</span>
                                </div>
                                <div>
                                    <span>Unvalidation: </span>
                                    <span id="unvalidation-source-item">20</span>
                                </div> -->
                                <div style="padding:30px 80px 10px 80px;" id="title-source-item">
                                    Source
                                </div>
                                <div class="item-analysis" style="padding: 10px;">
                                    <div style="text-align: right;" class="icon-item-analysis">
                                        <i class="fa fa-calendar" style="color: #64bb5d;" aria-hidden="true"></i>
                                    </div>
                                    <div style="text-align: left;" class="detail-item-analysis">
                                        <div class="title-detail-item-analysis">
                                            Total
                                        </div>
                                        <div class="value-detail-item-analysis" id="total-claim-source-item">
                                            2000
                                        </div>
                                    </div>
                                </div>
                                <div class="item-analysis" style="padding: 10px;">
                                    <div style="text-align: right;" class="icon-item-analysis">
                                        <i class="fa fa-calendar" style="color: #c0392b;" aria-hidden="true"></i>
                                    </div>
                                    <div style="text-align: left;" class="detail-item-analysis">
                                        <div class="title-detail-item-analysis">
                                            Credibility
                                        </div>
                                        <div class="value-detail-item-analysis" id="validation-source-item">
                                            1000
                                        </div>
                                    </div>
                                </div>
                                <div class="item-analysis" style="padding: 10px;">
                                    <div style="text-align: right;" class="icon-item-analysis">
                                        <i class="fa fa-calendar" style="color: #f39c12;" aria-hidden="true"></i>
                                    </div>
                                    <div style="text-align: left;" class="detail-item-analysis">
                                        <div class="title-detail-item-analysis">
                                            Non-Credibility
                                        </div>
                                        <div class="value-detail-item-analysis" id="unvalidation-source-item">
                                            20
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div style="height: 580px;" id="claims" class="tabcontent item-tab">
                        <div id="block-content2">
                            <div>
                                <div id="title-list-claim">
                                    <span>Claims</span>
                                    <!-- <select name="mode" onchange="selectMode(this)">
                                        <option value="block-list-claim" selected>Claims</option>
                                        <option value="block-list-source">Sources</option>
                                    </select> -->
                                    <input type="text" id="input-for-claim" onkeyup="searchClaim()"
                                        placeholder="Search for claims.." title="Type in a name">
                                </div>
                                <div id="block-list-claim">
                                    <ul id="list-claim">
                                        {% for claim in data %}
                                        <li onclick="selectClaim({{ loop.index - 1 }})" id="{{ claim.id }}">
                                            <div>
                                                <span class="no-claim">{{ loop.index }}. </span> {{ claim.claim }}
                                            </div>
                                            <div class="container">
                                                <div class="progress2 progress-moved">
                                                    <div class="progress-bar2">
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                            <div class="detail content">
                                <div style="height: 580px;">
                                    <div class="tab">
                                        <button class="tablinkclaims" onclick="openTabClaim(event,'info-claim')"
                                            id="defaultDetails">Detail</button>
                                        <button class="tablinkclaims"
                                            onclick="openTabClaim(event, 'sources-claim')">Sources</button>
                                        <div>
                                            <form method=post action="/process">
                                                <input type="hidden" name="claimId" value="{{ data[0].claim_id }}">
                                                <!-- <div class="validation-claim"> -->
                                                <input type=submit style="margin-right: 30px;" class="btn-validation"
                                                    name="Credibility" value="Non-Credibility">
                                                <input type=submit class="btn-validation" name="Credibility"
                                                    value="Credibility">
                                                <!-- </div> -->
                                            </form>
                                        </div>
                                    </div>
                                    <div id="info-claim" class="tabclaims item-tab">
                                        <div>
                                            <div>
                                                <h4>
                                                    Origins
                                                </h4>
                                                <p id="origins-claim">
                                                    {{ data[0].origins }}
                                                </p>
                                            </div>
                                            <div>
                                                <h4>
                                                    Description
                                                </h4>
                                                <span>
                                                    <span id="description-short">
                                                        {{ data[0].description }}
                                                    </span>
                                                    <span id="dots">...</span>
                                                    <span id="more">
                                                        {{ data[0].description }}
                                                    </span>

                                                    <button onclick="readMore()" id="btn-readmore" class="button">Read
                                                        more</button>
                                            </div>
                                            <div>
                                                <h4>
                                                    Example
                                                </h4>
                                                <p id="example-claim">
                                                    {{ data[0].example }}
                                                </p>
                                            </div>
                                            <div>
                                                <h4>
                                                    Originally Published
                                                </h4>
                                                <p id="originally-published-claim">
                                                    {{ data[0].originally_published }}
                                                </p>
                                            </div>
                                            <div>
                                                <h4>
                                                    Last Updated
                                                </h4>
                                                <p id="last-updated-claim">
                                                    {{ data[0].last_updated }}
                                                </p>
                                            </div>
                                            <div id="tag-claim">
                                                {% for tag in data[0].tags%}
                                                <span class="tag-claim-item"> #{{ tag }} </span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                    <div id="sources-claim" class="tabclaims item-tab">
                                        <div class="chart-sources-claim"
                                            style="grid-column-start:1;grid-column-end: 3;text-align: center;background-color: #fff;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- <div id="sources">
                                <div class="chart" style="text-align: center;background-color: #fff;">
                                </div>
                            </div> -->
                        </div>
                    </div>


                    <!-- <div id="info-claim" class="tabcontent item-tab">

                    </div> -->
                    <!-- <div id="sources" class="tabcontent item-tab">
                            <div class="chart"
                                style="grid-column-start:1;grid-column-end: 3;text-align: center;background-color: #fff;">
                            </div>
                        </div> -->
                </div>
            </div>



            <div class="detail content" style="display: none;">
                <div style="height: 580px;">
                    <div class="tab">
                        <button class="tablinks" onclick="openCity(event,'info-claim')" id="defaultOpen">Detail</button>
                        <button class="tablinks" onclick="openCity(event, 'sources')">Sources</button>
                        <div>
                            <form method=post action="/process">
                                <input type="hidden" name="claimId" value="{{ data[0].claim_id }}">
                                <!-- <div class="validation-claim"> -->
                                <input type=submit style="margin-right: 30px;" class="btn-validation" name="Credibility"
                                    value="Non-Credibility">
                                <input type=submit class="btn-validation" name="Credibility" value="Credibility">
                                <!-- </div> -->
                            </form>
                        </div>
                    </div>
                    <!-- <div id="info-claim" class="tabcontent item-tab">
                        <div>
                            <div>
                                <h4>
                                    Origins
                                </h4>
                                <p id="origins-claim">
                                    {{ data[0].origins }}
                                </p>
                            </div>
                            <div>
                                <h4>
                                    Description
                                </h4>
                                <span>
                                    <span id="description-short">
                                        {{ data[0].description }}
                                    </span>
                                    <span id="dots">...</span>
                                    <span id="more">
                                        {{ data[0].description }}
                                    </span>

                                    <button onclick="readMore()" id="btn-readmore" class="button">Read more</button>
                            </div>
                            <div>
                                <h4>
                                    Example
                                </h4>
                                <p id="example-claim">
                                    {{ data[0].example }}
                                </p>
                            </div>
                            <div>
                                <h4>
                                    Originally Published
                                </h4>
                                <p id="originally-published-claim">
                                    {{ data[0].originally_published }}
                                </p>
                            </div>
                            <div>
                                <h4>
                                    Last Updated
                                </h4>
                                <p id="last-updated-claim">
                                    {{ data[0].last_updated }}
                                </p>
                            </div>
                            <div id="tag-claim">
                                {% for tag in data[0].tags%}
                                <span class="tag-claim-item"> #{{ tag }} </span>
                                {% endfor %}
                            </div>
                        </div>
                    </div> -->
                    <div id="sources" class="tabcontent item-tab">
                        <div class="chart"
                            style="grid-column-start:1;grid-column-end: 3;text-align: center;background-color: #fff;">
                        </div>
                    </div>
                </div>
            </div>
            <div style="height: 580px;display: none;" id="overview-sources">
                <h3>Heatmap Sources</h3>
                <div id="heatmap-sources">
                </div>
            </div>

            <!-- </div> -->
        </div>
    </div>

    <!-- <script type="text/javascript" src="{{ url_for('static', filename='js/d3.v3.min.js') }}"></script> -->
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <!-- <script type="text/javascript" src="{{ url_for('static', filename='js/conversation.min.js') }}"></script> -->
    <script>
        var claims = {{ data| tojson }};
        var mapClaim = new Map();
        var i;
        for (i = 0; i < claims.length; i++) {
            mapClaim.set(claims[i].id, i);
        }
    </script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/fact.js') }}"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <script>
        var marginChartOverview = { top: 30, right: 30, bottom: 30, left: 50 },
            widthChartOverview =
                460 - marginChartOverview.left - marginChartOverview.right,
            heightChartOverview =
                250 - marginChartOverview.top - marginChartOverview.bottom;

        // append the svg object to the body of the page
        var svgChart = d3
            .select("#my_dataviz")
            .append("svg")
            .attr(
                "width",
                widthChartOverview + marginChartOverview.left + marginChartOverview.right
            )
            .attr(
                "height",
                heightChartOverview + marginChartOverview.top + marginChartOverview.bottom
            )
            .append("g")
            .attr(
                "transform",
                "translate(" +
                marginChartOverview.left +
                "," +
                marginChartOverview.top +
                ")"
            );

        // get the data
        d3.csv(
            "https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/1_OneNum.csv",
            function (data) {
                // add the x Axis
                var x = d3
                    .scaleLinear()
                    .domain([0, 1000])
                    .range([0, widthChartOverview]);
                svgChart
                    .append("g")
                    .attr("transform", "translate(0," + heightChartOverview + ")")
                    .call(d3.axisBottom(x));

                // add the y Axis
                var y = d3
                    .scaleLinear()
                    .range([heightChartOverview, 0])
                    .domain([0, 0.01]);
                svgChart.append("g").call(d3.axisLeft(y));

                // Compute kernel density estimation
                var kde = kernelDensityEstimator(kernelEpanechnikov(7), x.ticks(40));
                var density = kde(
                    data.map(function (d) {
                        return d.price;
                    })
                );

                // Plot the area
                var curve = svgChart
                    .append("g")
                    .append("path")
                    .attr("class", "mypath")
                    .datum(density)
                    .attr("fill", "#69b3a2")
                    .attr("opacity", ".8")
                    .attr("stroke", "#000")
                    .attr("stroke-width", 1)
                    .attr("stroke-linejoin", "round")
                    .attr(
                        "d",
                        d3
                            .line()
                            .curve(d3.curveBasis)
                            .x(function (d) {
                                return x(d[0]);
                            })
                            .y(function (d) {
                                return y(d[1]);
                            })
                    );

                // A function that update the chart when slider is moved?
                function updateChart(binNumber) {
                    // recompute density estimation
                    kde = kernelDensityEstimator(kernelEpanechnikov(7), x.ticks(binNumber));
                    density = kde(
                        data.map(function (d) {
                            return d.price;
                        })
                    );
                    console.log(binNumber);
                    console.log(density);

                    // update the chart
                    curve
                        .datum(density)
                        .transition()
                        .duration(1000)
                        .attr(
                            "d",
                            d3
                                .line()
                                .curve(d3.curveBasis)
                                .x(function (d) {
                                    return x(d[0]);
                                })
                                .y(function (d) {
                                    return y(d[1]);
                                })
                        );
                }

                // Listen to the slider?
                d3.select("#mySlider").on("change", function (d) {
                    selectedValue = this.value;
                    updateChart(selectedValue);
                });
            }
        );

        // Function to compute density
        function kernelDensityEstimator(kernel, X) {
            return function (V) {
                return X.map(function (x) {
                    return [
                        x,
                        d3.mean(V, function (v) {
                            return kernel(x - v);
                        })
                    ];
                });
            };
        }
        function kernelEpanechnikov(k) {
            return function (v) {
                return Math.abs((v /= k)) <= 1 ? (0.75 * (1 - v * v)) / k : 0;
            };
        }

    </script>
    <script>

        // set the dimensions and margins of the graph
        // var margin = {top: 80, right: 25, bottom: 30, left: 40},
        //   width = 450 - margin.left - margin.right,
        //   height = 450 - margin.top - margin.bottom;
        var table = d3.select("table");
        d3.json("http://localhost:5050/source/claim", function (data) {
            var table = d3.select("table")
                .selectAll("tr")
                .data(data)
                .enter()
                .append("tr")
            table.append("td")
                .text(function (d) { return d.source })
                .style("text-align", "right")

            table.append("td")
                .attr("id", function (d) { return d.source.replace(/\./g, '') })
                .style("text-align","left")

            data.map((source) => {
                console.log(source);
                var widthCell = 20, heightCell = 20, p = 20;

                var width = widthCell * source.claims.length, height = heightCell * Math.ceil(source.claims.length / p);
                // var data = data[0];

                // append the svg object to the body of the page
                var sourceId = "#" + source.source.replace(/\./g, '');
                var svg = d3.select(sourceId)
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)


                var colorClaim = d3.scaleLinear().domain([1, 10])
                    .range(["#a9a9a9", "rgb(237,105,37)"])

                var tooltip = d3.select("#overview-sources")
                    .append("div")
                    .style("opacity", 0)
                    .attr("class", "tooltip")
                    .style("background-color", "white")
                    .style("border", "solid")
                    .style("border-width", "2px")
                    .style("border-radius", "5px")
                    .style("padding", "5px")
                    .style("position", "fixed")
                    .style("max-width", "250px")
                // .style("margin-top", "20px")


                // Three function that change the tooltip when user hover / move / leave a cell
                var mouseover = function (d) {
                    tooltip
                        .style("opacity", 1)
                    d3.select(this)
                        .style("stroke", "black")
                        .style("opacity", 1)

                    document.getElementById("title-source-item").innerHTML = source.source;
                    document.getElementById("total-claim-source-item").innerHTML = source.total;
                    document.getElementById("validation-source-item").innerHTML = source.credibility;
                    document.getElementById("unvalidation-source-item").innerHTML = d.uncredibility;
                }
                var mousemove = function (d) {
                    var mouseTop = d3.mouse(this)[1] < 300 ? d3.mouse(this)[1] + 300 : d3.mouse(this)[1];
                    var mouseTop = (d3.mouse(this)[1] % 10) + 350;
                    tooltip
                        .html(d.claim)
                        .style("left", (d3.mouse(this)[0] + 200) + "px")
                        .style("top", (mouseTop) + "px")
                    console.log(d3.mouse(this)[0], mouseTop);
                }
                var mouseleave = function (d) {
                    tooltip
                        .style("opacity", 0)
                    d3.select(this)
                        .style("stroke", "white")
                        .style("opacity", 0.8)
                }

                var rectClick = function (d) {
                    openCity(event, "claims");
                    selectClaim(mapClaim.get(d.claim_id));
                    var claimLi = document.getElementById(d.claim_id);
                    claimLi.scrollIntoView(false);
                }

                svg.selectAll("rect")
                    .data(source.claims)
                    .enter()
                    .append("rect")
                    .attr("x", function (d, i) { return widthCell * (i % p); })
                    .attr("y", function (d, i) { return heightCell * (Math.floor(i / p)); })
                    .attr("width", "20")
                    .attr("height", "20")
                    .style("fill", function (d) { return colorClaim(d.credibility_claim); })
                    .style("stroke-width", 1)
                    .style("stroke", "white")
                    .style("opacity", 0.8)
                    .on("mouseover", mouseover)
                    .on("mousemove", mousemove)
                    .on("mouseleave", mouseleave)
                    .on("click", rectClick);
            });

        })

    </script>

    <!-- <script>

        //Read the data
        // d3.csv("data/heatmap_data.csv", function (data) {
        d3.json("http://localhost:5050/sc", function (data) {



            var maxIndex = data.max_index;
            var sources = data.sources;
            var relations = data.relations;

            var totalWidthCell = maxIndex * 20;
            var totalHeightCell = sources.length * 20;

            // set the dimensions and margins of the graph
            var margin = { top: 40, right: 25, bottom: 30, left: 180 },
                // width = 450 - margin.left - margin.right,
                // height = 450 - margin.top - margin.bottom;
                width = 1000 - margin.left - margin.right,
                height = totalHeightCell + 100 - margin.top - margin.bottom;

            // width = 600;
            // height = 1000;

            // append the svg object to the body of the page
            var svgHeatmap = d3.select("#heatmap-sources")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            var cells = [];
            var i;
            for (i = 0; i <= maxIndex; i++) {
                cells[i] = i;
            };
            // console.log(cells);
            // console.log(sources);

            // data[0][1].x = 0;
            // console.log(data[0]);

            // Labels of row and columns -> unique identifier of the column called 'group' and 'variable'
            // var myGroups = d3.map(data, function (d) { return d.group; }).keys()
            // var myVars = d3.map(data, function (d) { return d.variable; }).keys()
            // console.log(myGroups);
            // console.log(myVars);

            // Build X scales and axis:
            var x = d3.scaleBand()
                .range([0, totalWidthCell])
                .domain(cells)
                .padding(0.05);
            // svg.append("g")
            //     .style("font-size", 15)
            //     .attr("transform", "translate(0," + height + ")")
            //     .call(d3.axisBottom(x).tickSize(0))
            //     .select(".domain").remove()

            // Build Y scales and axis:
            var y = d3.scaleBand()
                .range([totalHeightCell, 0])
                .domain(sources)
                .padding(0.05);

            svgHeatmap.append("g")
                .style("font-size", 13)
                .call(d3.axisLeft(y).tickSize(0))
                .select(".domain").remove()

            // Build color scale
            // var myColor = d3.scaleSequential()
            //     .interpolator(d3.interpolateInferno)
            //     .domain([1, 100])
            // var myColor = d3.scaleOrdinal().domain(cells)
            //     .range(["#c0392b", "#eea303", "#f1c40f", "#64bb5d", "#16a085", "#0e83cd", "#702fa8"])
            var myColor = d3.scaleLinear().domain([1, 10])
                .range(["#a9a9a9", "rgb(237,105,37)"])
            // create a tooltip
            // var tooltip = d3.select("#heatmap-sources")
            var tooltip = d3.select("#overview-sources")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "2px")
                .style("border-radius", "5px")
                .style("padding", "5px")
                .style("position","fixed")
                .style("max-width","250px")
                // .style("margin-top", "20px")


            // Three function that change the tooltip when user hover / move / leave a cell
            var mouseover = function (d) {
                tooltip
                    .style("opacity", 1)
                d3.select(this)
                    .style("stroke", "black")
                    .style("opacity", 1)

                document.getElementById("title-source-item").innerHTML = d.source;
                document.getElementById("total-claim-source-item").innerHTML = d.total;
                document.getElementById("validation-source-item").innerHTML = d.validation;
                document.getElementById("unvalidation-source-item").innerHTML = d.unvalidation;
            }
            var mousemove = function (d) {
                var mouseTop = d3.mouse(this)[1] < 300 ? d3.mouse(this)[1] + 300 : d3.mouse(this)[1];
                var mouseTop = (d3.mouse(this)[1] % 10) + 350;
                tooltip
                    .html(d.claim)
                    .style("left", (d3.mouse(this)[0] + 200) + "px")
                    .style("top", (mouseTop) + "px")
                console.log(d3.mouse(this)[0],mouseTop);
            }
            var mouseleave = function (d) {
                tooltip
                    .style("opacity", 0)
                d3.select(this)
                    .style("stroke", "none")
                    .style("opacity", 0.8)
            }

            var rectClick = function (d) {
                openCity(event, "claims");
                selectClaim(mapClaim.get(d.claim_id));
                var claimLi = document.getElementById(d.claim_id);
                claimLi.scrollIntoView(false);
            }

            // add the squares
            svgHeatmap.selectAll()
                .append("g")
                .data(relations, function (d) { return d.index + ':' + d.source; })
                .enter()
                .append("rect")
                .attr("x", function (d) { return x(d.index) })
                .attr("y", function (d) { return y(d.source) })
                // .attr("rx", 4)
                // .attr("ry", 4)
                .attr("width", x.bandwidth())
                .attr("height", y.bandwidth())
                .style("fill", function (d) { return myColor(d.credibility_claim) })
                .style("stroke-width", 1)
                .style("stroke", "none")
                .style("opacity", 0.8)
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
                .on("click", rectClick)
        })

        // Add title to graph
        // svg.append("text")
        //     .attr("x", 0)
        //     .attr("y", -50)
        //     .attr("text-anchor", "left")
        //     .style("font-size", "22px")
        //     .text("Heatmap Sources");

        // // Add subtitle to graph
        // svg.append("text")
        //     .attr("x", 0)
        //     .attr("y", -20)
        //     .attr("text-anchor", "left")
        //     .style("font-size", "14px")
        //     .style("fill", "grey")
        //     .style("max-width", 400)
        //     .text("A short description of the take-away message of this chart.");


    </script> -->
    <script>
        $(document).ready(function () {
            document.getElementById('{{ data[0].id }}').click();
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
        var randomScalingFactor = function () {
            return Math.floor(Math.random() * 10);
            // return Math.ceil(Math.random() * 10.0) * Math.pow(10, Math.ceil(Math.random() * 5));
        };

        var config = {
            type: 'line',
            data: {
                labels: ['100', '200', '300', '400', '500', '600', '700'],
                datasets: [{
                    label: 'Model',
                    backgroundColor: window.chartColors.red,
                    borderColor: window.chartColors.red,
                    fill: false,
                    data: [
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor()
                    ],
                }, {
                    label: 'User Input',
                    backgroundColor: window.chartColors.blue,
                    borderColor: window.chartColors.blue,
                    fill: false,
                    data: [
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor()
                    ],
                }]
            },
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: 'Comparison Model and User Input'
                },
                scales: {
                    xAxes: [{
                        display: true,
                    }],
                    yAxes: [{
                        display: true,
                        type: 'logarithmic',
                    }]
                }
            }
        };

        window.onload = function () {
            var ctx = document.getElementById('canvas').getContext('2d');
            window.myLine = new Chart(ctx, config);
        };

        document.getElementById('randomizeData').addEventListener('click', function () {
            config.data.datasets.forEach(function (dataset) {
                dataset.data = dataset.data.map(function () {
                    return randomScalingFactor();
                });

            });

            window.myLine.update();
        });
    </script>
</body>



<script type="text/javascript" src="{{ url_for('static', filename='js/modal.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/search.js') }}"></script>

</html>