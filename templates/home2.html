<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <meta charset="UTF-8"> -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/style.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/modal.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/font.css') }}">
    <!-- <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/graph.css') }}"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- <link href='https://fonts.googleapis.com/css?family=Open+Sans|Open+Sans+Condensed:300,700' rel='stylesheet' type='text/css'> -->
    <!-- <script type="text/javascript" src="{{ url_for('static', filename='js/fact.js') }}"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script> -->

    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!-- <script src="//d3js.org/d3-scale-chromatic.v1.min.js"></script> -->

    <!-- conversation -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Fact Checking</title>
    <link rel='stylesheet' id='style-css' href="{{ url_for('static', filename='styles/style_conservation.css') }}"
        type='text/css' media='all' />
</head>

<body>
    <div id="budget-modal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Optimize Budget Allocation</h2>
            </div>
            <div class="modal-body">
                <form method=post action="/" enctype=multipart/form-data> <h4>Budget</h4>
                    <input type=number value=0 name=budget style="font-size: 18px;">
                    <input type="submit" value="OK" class="button">
                </form>
            </div>
        </div>
    </div>
    <div class="grid-container">
        <div class="header">
            <div class="grid-header">
                <div id="logo-griffith">
                    <a href="/">
                        <div>Fact Checking</div>
                    </a>
                </div>
                <div id="select-file" class="header-content">
                    <form method=post action="/upload" enctype=multipart/form-data> <input type="file" name="file"
                        id="file" class="inputfile" data-multiple-caption="{count} files selected" multiple />
                    <input type=submit value=Upload id="upload-btn">
                    </form>
                </div>
                <div class="header-content" style="text-align: right;">
                    <button class="button">
                        <a href="/download" style="color: white">Take Snapshot</a>
                    </button>
                    <!-- <a class="button" href="/download">Take Snapshot</a> -->
                    <button class="button" id="myBtn">Optimize Budget Allocation</button>
                    <button class="button">Stop Feedback</button>
                </div>
            </div>
        </div>
        <div id="block-content">
            <div>
                <div id="title-list-claim">
                    <!-- <span>Claims</span> -->
                    <select name="mode" onchange="selectMode(this)">
                        <option value="block-list-claim" selected>Claims</option>
                        <option value="block-list-source">Sources</option>
                    </select>
                    <input type="text" id="input-for-claim" onkeyup="searchClaim()" placeholder="Search for claims.."
                        title="Type in a name">
                </div>
                <div id="block-list-claim" class="listcontent item-select">
                    <ul id="list-claim">
                        {% for claim in data %}
                        <li onclick="selectClaim({{ loop.index }},{{ claim }});drawRelation({{ claim }})"
                            id="{{ claim.id }}">
                            <div>
                                <span class="no-claim">{{ loop.index }}. </span> {{ claim.claim }}
                            </div>
                            <div class="container">
                                <div class="progress2 progress-moved">
                                    <div class="progress-bar2">
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                <div id="block-list-source" class="listcontent item-select">
                    <ul>
                        {%for source in sources%}
                        <li>
                            <div class="title-source">
                                <!-- <span class="no-claim">{{ loop.index }}. </span> -->
                                {{ source[0] }}
                            </div>
                            <!-- <div class="complete-source">
                                <div style="float: left;padding: 0;margin: 0;">Complete</div>
                                <div style="float: right;padding: 0;margin: 0; " >3/10</span>
                            </div> -->
                            <!-- <div class="content-source-item">
                                <ul>
                                    {% for claim in source[1] %}
                                    <li onclick="selectClaim({{ loop.index }},{{ claim }});drawRelation({{ claim }})"
                                        id="{{ claim.id }}">
                                        <div style="font-size: 12px;">
                                            <span class="no-claim" style="font-size: 12px;">{{ loop.index }}. </span>
                                            {{ claim.claim }}
                                        </div>
                                        <div class="container">
                                            <div class="progress2 progress-moved">
                                                <div class="progress-bar2" style="height: 2px;">
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </ul>
                            </div> -->
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div class="detail content" style="display:none">
                <div style="height: 580px;">
                    <div class="tab">
                        <button class="tablinks" onclick="openCity(event,'info-claim')" id="defaultOpen">Detail</button>
                        <button class="tablinks" onclick="openCity(event, 'sources')">Sources</button>
                        <div>
                            <form method=post action="/process">
                                <input type="hidden" name="claimId" value="{{ data[0].claim_id }}">
                                <!-- <div class="validation-claim"> -->
                                <input type=submit style="margin-right: 30px;" class="btn-validation" name="Credibility"
                                    value="Non-Credibility">
                                <input type=submit class="btn-validation" name="Credibility" value="Credibility">
                                <!-- </div> -->
                            </form>
                        </div>
                    </div>
                    <div id="info-claim" class="tabcontent item-tab">
                        <div>
                            <div>
                                <h4>
                                    Origins
                                </h4>
                                <p id="origins-claim">
                                    {{ data[0].origins }}
                                </p>
                            </div>
                            <div>
                                <h4>
                                    Description
                                </h4>
                                <span>
                                    <span id="description-short">
                                        {{ data[0].description }}
                                    </span>
                                    <span id="dots">...</span>
                                    <span id="more">
                                        {{ data[0].description }}
                                    </span>

                                    <button onclick="readMore()" id="btn-readmore" class="button">Read more</button>
                            </div>
                            <div>
                                <h4>
                                    Example
                                </h4>
                                <p id="example-claim">
                                    {{ data[0].example }}
                                </p>
                            </div>
                            <div>
                                <h4>
                                    Originally Published
                                </h4>
                                <p id="originally-published-claim">
                                    {{ data[0].originally_published }}
                                </p>
                            </div>
                            <div>
                                <h4>
                                    Last Updated
                                </h4>
                                <p id="last-updated-claim">
                                    {{ data[0].last_updated }}
                                </p>
                            </div>
                            <div id="tag-claim">
                                {% for tag in data[0].tags%}
                                <span class="tag-claim-item"> #{{ tag }} </span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div id="sources" class="tabcontent item-tab">
                        <div class="chart"
                            style="grid-column-start:1;grid-column-end: 3;text-align: center;background-color: #fff;">
                        </div>
                    </div>
                </div>
            </div>
                <div style="height: 580px;" id="overview-sources" style="display: none;">
                    <h3>Heatmap Sources</h3>
                    <div id="heatmap-sources">
                    </div>
                </div>

            <!-- </div> -->
        </div>
    </div>

    <!-- <script type="text/javascript" src="{{ url_for('static', filename='js/d3.v3.min.js') }}"></script> -->
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <!-- <script type="text/javascript" src="{{ url_for('static', filename='js/conversation.min.js') }}"></script> -->
    <script type="text/javascript" src="{{ url_for('static', filename='js/fact.js') }}"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <script>
        // set the dimensions and margins of the graph
        var margin = { top: 10, right: 25, bottom: 30, left: 180 },
            // width = 450 - margin.left - margin.right,
            // height = 450 - margin.top - margin.bottom;
            width = 1000 - margin.left - margin.right,
            height = 600 - margin.top - margin.bottom;

        // width = 600;
        // height = 1000;

        // append the svg object to the body of the page
        var svg = d3.select("#heatmap-sources")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        //Read the data
        // d3.csv("data/heatmap_data.csv", function (data) {
        d3.json("http://localhost:5050/sc", function (data) {

            var maxIndex = data.max_index;
            var sources = data.sources;
            var relations = data.relations;

            var totalWidthCell = maxIndex * 20;
            var totalHeightCell = sources.length * 20;

            var cells = [];
            var i;
            for (i = 0; i <= maxIndex; i++) {
                cells[i] = i;
            };
            // console.log(cells);
            // console.log(sources);

            // data[0][1].x = 0;
            // console.log(data[0]);

            // Labels of row and columns -> unique identifier of the column called 'group' and 'variable'
            // var myGroups = d3.map(data, function (d) { return d.group; }).keys()
            // var myVars = d3.map(data, function (d) { return d.variable; }).keys()
            // console.log(myGroups);
            // console.log(myVars);

            // Build X scales and axis:
            var x = d3.scaleBand()
                .range([0, totalWidthCell])
                .domain(cells)
                .padding(0.05);
            // svg.append("g")
            //     .style("font-size", 15)
            //     .attr("transform", "translate(0," + height + ")")
            //     .call(d3.axisBottom(x).tickSize(0))
            //     .select(".domain").remove()

            // Build Y scales and axis:
            var y = d3.scaleBand()
                .range([totalHeightCell, 0])
                .domain(sources)
                .padding(0.05);
            svg.append("g")
                .style("font-size", 13)
                .call(d3.axisLeft(y).tickSize(0))
                .select(".domain").remove()

            // Build color scale
            // var myColor = d3.scaleSequential()
            //     .interpolator(d3.interpolateInferno)
            //     .domain([1, 100])
            var myColor = d3.scaleOrdinal().domain(cells)
                .range(["#c0392b", "#eea303", "#f1c40f", "#64bb5d", "#16a085", "#0e83cd", "#702fa8"])
            // create a tooltip
            // var tooltip = d3.select("#heatmap-sources")
            var tooltip = d3.select("#overview-sources")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "2px")
                .style("border-radius", "5px")
                .style("padding", "5px")
                .style("margin-top","20px")

            // Three function that change the tooltip when user hover / move / leave a cell
            var mouseover = function (d) {
                tooltip
                    .style("opacity", 1)
                d3.select(this)
                    .style("stroke", "black")
                    .style("opacity", 1)
            }
            var mousemove = function (d) {
                tooltip
                    .html(d.claim)
                    .style("left", (d3.mouse(this)[0] + 70) + "px")
                    .style("top", (d3.mouse(this)[1]) + "px")
            }
            var mouseleave = function (d) {
                tooltip
                    .style("opacity", 0)
                d3.select(this)
                    .style("stroke", "none")
                    .style("opacity", 0.8)
            }

            // add the squares
            svg.selectAll()
                .data(relations, function (d) { return d.index + ':' + d.source; })
                .enter()
                .append("rect")
                .attr("x", function (d) { return x(d.index) })
                .attr("y", function (d) { return y(d.source) })
                .attr("rx", 4)
                .attr("ry", 4)
                .attr("width", x.bandwidth())
                .attr("height", y.bandwidth())
                .style("fill", function (d) { return myColor(d.credibility_claim) })
                .style("stroke-width", 4)
                .style("stroke", "none")
                .style("opacity", 0.8)
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
        })

        // Add title to graph
        // svg.append("text")
        //     .attr("x", 0)
        //     .attr("y", -50)
        //     .attr("text-anchor", "left")
        //     .style("font-size", "22px")
        //     .text("Heatmap Sources");

        // // Add subtitle to graph
        // svg.append("text")
        //     .attr("x", 0)
        //     .attr("y", -20)
        //     .attr("text-anchor", "left")
        //     .style("font-size", "14px")
        //     .style("fill", "grey")
        //     .style("max-width", 400)
        //     .text("A short description of the take-away message of this chart.");


    </script>
    <script>
        $(document).ready(function () {
            document.getElementById('{{ data[0].id }}').click();
        });
    </script>
</body>
<script type="text/javascript" src="{{ url_for('static', filename='js/modal.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/search.js') }}"></script>

</html>